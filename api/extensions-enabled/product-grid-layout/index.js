import{defineLayout as e,useCollection as t}from"@directus/extensions-sdk";import{defineComponent as l,ref as a,computed as i,resolveComponent as o,openBlock as n,createElementBlock as u,normalizeClass as r,createCommentVNode as s,Fragment as d,createElementVNode as c,createVNode as v,toDisplayString as p,withCtx as m,createTextVNode as f,renderList as y,createBlock as b,watch as g,onMounted as h,createSlots as _,unref as w,isRef as O,toRefs as k,inject as C}from"vue";import{useI18n as P}from"vue-i18n";import{useRouter as S}from"vue-router";const x={key:0,class:"null-value"},j={class:"boolean-value"},A={class:"metric-value"},I={class:"value"},H={key:0,class:"unit"},V={class:"date-value"},U={class:"chips-value"},N={key:0,class:"more-count"},F={key:0,class:"image-value"},E=["src","alt"],$={class:"table-value"},T=["title"],D={class:"number-value"},R=["title"];var K=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l},M=K(l({__name:"GridAttributeValue",props:{value:{},attribute:{}},setup(e){const t=e,l=a(!1),g=i((()=>{if(!t.value)return null;try{if("object"==typeof t.value)return t.value;return JSON.parse(t.value)}catch(e){return t.value}})),h=i((()=>{const e=g.value;return e&&"object"==typeof e&&"value"in e?e.value:e})),_=i((()=>{var e;const l=g.value;if(l&&"object"==typeof l&&l.unit){if(null==(e=t.attribute)?void 0:e.units){const e=t.attribute.units.find((e=>e.id===l.unit));return(null==e?void 0:e.code)||l.unit}return l.unit}return null})),w=i((()=>{var e,l;return(null==(l=null==(e=t.attribute)?void 0:e.type)?void 0:l.input_interface)||"text"})),O=i((()=>null===h.value||void 0===h.value||""===h.value)),k=i((()=>({"is-empty":O.value,"is-boolean":"yes_no"===w.value,"is-metric":["price","metric"].includes(w.value),"is-image":"image"===w.value,"has-error":l.value}))),C=e=>{const t=parseFloat(e);return isNaN(t)?e:"price"===w.value?new Intl.NumberFormat("nb-NO",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t):new Intl.NumberFormat("en-US",{style:"decimal",maximumFractionDigits:2}).format(t)},P=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}},S=e=>{var l;if(!(null==(l=t.attribute)?void 0:l.options))return e;const a=t.attribute.options.find((t=>t.code===e));return(null==a?void 0:a.label)||e},K=e=>Array.isArray(e)?e.slice(0,3):[e],M=(e,t)=>e.length<=t?e:e.substring(0,t)+"...";return(e,t)=>{var a,i,g;const W=o("v-icon"),z=o("v-chip");return n(),u("div",{class:r(["grid-attribute-value",k.value])},[s(" Null/Empty Value "),O.value?(n(),u("span",x,"-")):"yes_no"===w.value?(n(),u(d,{key:1},[s(" Boolean/Yes-No "),c("div",j,[v(W,{name:h.value?"check_circle":"cancel",class:r({yes:h.value,no:!h.value}),small:""},null,8,["name","class"]),c("span",null,p(h.value?"Yes":"No"),1)])],64)):"price"===w.value||"metric"===w.value?(n(),u(d,{key:2},[s(" Price/Metric "),c("div",A,[c("span",I,p(C(h.value)),1),_.value?(n(),u("span",H,p(_.value),1)):s("v-if",!0)])],64)):"date"===w.value?(n(),u(d,{key:3},[s(" Date "),c("span",V,p(P(h.value)),1)],64)):"simple_select"===w.value&&(null==(a=e.attribute)?void 0:a.options)?(n(),u(d,{key:4},[s(" Simple Select "),v(z,{small:""},{default:m((()=>[f(p(S(h.value)),1)])),_:1})],64)):"multi_select"===w.value&&(null==(i=e.attribute)?void 0:i.options)?(n(),u(d,{key:5},[s(" Multi Select "),c("div",U,[(n(!0),u(d,null,y(K(h.value),(e=>(n(),b(z,{key:e,"x-small":""},{default:m((()=>[f(p(S(e)),1)])),_:2},1024)))),128)),K(h.value).length>3?(n(),u("span",N," +"+p(K(h.value).length-3),1)):s("v-if",!0)])],64)):"image"===w.value?(n(),u(d,{key:6},[s(" Image "),h.value?(n(),u("div",F,[c("img",{src:(J=h.value,l.value?"":`/assets/${J}?width=40&height=40&fit=cover`),alt:(null==(g=e.attribute)?void 0:g.label)||"Image",onError:t[0]||(t[0]=e=>l.value=!0)},null,40,E)])):s("v-if",!0)],64)):"table"===w.value?(n(),u(d,{key:7},[s(" Table "),c("div",$,[v(W,{name:"table_chart",small:""}),c("span",null,p((B=h.value,Array.isArray(B)?0===B.length?"No rows":`${B.length} row${1!==B.length?"s":""}`:"Invalid data")),1)])],64)):["text","identifier"].includes(w.value)?(n(),u(d,{key:8},[s(" Text/Identifier "),c("span",{class:"text-value",title:String(h.value)},p(M(String(h.value),50)),9,T)],64)):"number"===w.value?(n(),u(d,{key:9},[s(" Number "),c("span",D,p(C(h.value)),1)],64)):(n(),u(d,{key:10},[s(" Default "),c("span",{class:"default-value",title:String(h.value)},p(M(String(h.value),50)),9,R)],64))],2);var B,J}}}),[["__file","GridAttributeValue.vue"]]);const W={class:"product-image"};var z=l({__name:"ProductImage",props:{imageId:{default:null},alt:{default:"Product image"}},setup(e){const t=a(!1),l=()=>{t.value=!0};return(e,t)=>{const a=o("v-icon"),i=o("v-image"),r=o("v-avatar");return n(),u("div",W,[v(r,{large:"",color:"background-subdued"},{default:m((()=>[e.imageId?s("v-if",!0):(n(),b(a,{key:0,name:"image",color:"foreground-subdued"})),e.imageId?(n(),b(i,{key:1,src:`/assets/${e.imageId}?fit=cover&width=60&height=60&quality=80`,alt:e.alt,onError:l},null,8,["src","alt"])):s("v-if",!0)])),_:1})])}}}),B=[],J=[];function G(e,t){if(e&&"undefined"!=typeof document){var l,a=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var n=B.indexOf(o);-1===n&&(n=B.push(o)-1,J[n]={}),l=J[n]&&J[n][a]?J[n][a]:J[n][a]=u()}else l=u();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function u(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),i=0;i<l.length;i++)e.setAttribute(l[i],t.attributes[l[i]]);var n="prepend"===a?"afterbegin":"beforeend";return o.insertAdjacentElement(n,e),e}}G("\n.product-image[data-v-158841fb] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.product-image[data-v-158841fb] img {\n\tborder-radius: var(--border-radius);\n\tobject-fit: cover;\n}\n",{});var L=K(z,[["__scopeId","data-v-158841fb"],["__file","ProductImage.vue"]]),q=Object.defineProperty,Q=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,te=(e,t,l)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,le=(e,t)=>{for(var l in t||(t={}))Z.call(t,l)&&te(e,l,t[l]);if(X)for(var l of X(t))ee.call(t,l)&&te(e,l,t[l]);return e},ae=(e,t)=>Q(e,Y(t));const ie={class:"product-table-wrapper"},oe={class:"column-selector"},ne={class:"column-selector-header"},ue={class:"column-groups"},re={class:"column-group"},se={class:"column-group-header"},de={key:0,class:"column-group"},ce={class:"column-group-header"},ve={class:"column-selector-footer"},pe={class:"footer"},me={class:"pagination"},fe={key:0,class:"per-page"};var ye=l({__name:"ProductTable",props:{items:{default:()=>[]},loading:{type:Boolean,default:!1},collection:{},selection:{default:()=>[]},showSelect:{default:"none"},readonly:{type:Boolean,default:!1},tableHeaders:{default:()=>[]},tableSort:{default:null},tableRowHeight:{default:80},onRowClick:{},onSortChange:{},page:{default:1},toPage:{},totalPages:{default:1},itemCount:{default:0},limit:{default:25},primaryKeyField:{},availableFields:{default:()=>[]},attributes:{default:()=>[]},layoutOptions:{}},emits:["update:selection","update:tableHeaders","update:limit","update:layoutOptions"],setup(e,{emit:t}){const l=e,r=t,{t:w}=P();g((()=>l.items),(e=>{if(e&&e.length>0){const t=e.find((e=>"10000132"===e.attr_sku||10000132===e.attr_sku));t&&t.product_assets&&t.product_assets.length>0&&console.log("[ProductTable] SKU 10000132 asset details:",t.product_assets[0])}}),{immediate:!0});const O={select_columns:"Select Columns",search_columns:"Search columns...",standard_fields:"Standard Fields",attributes:"Attributes",reset_to_default:"Reset to Default",apply:"Apply",hide_field:"Hide Field",manage_columns:"Manage Columns",per_page:"Per Page"},k=e=>{try{return w(e)}catch(t){return O[e]||e}},C=a(),S=a(!1),x=a(""),j=a([]),A=a(!1),I=["25","50","100","250","500","1000"],H=i({get:()=>l.selection,set:e=>r("update:selection",e)}),V=i({get:()=>l.limit,set:e=>r("update:limit",e)});i((()=>{if(!l.itemCount||0===l.itemCount)return"";return`${(l.page-1)*l.limit+1}-${Math.min(l.page*l.limit,l.itemCount)} of ${l.itemCount}`}));const U=i((()=>[{text:"ID",value:"id",field:{type:"string"},standard:!0},{text:"UUID",value:"uuid",field:{type:"string"},standard:!0},{text:"Image",value:"primary_image",field:{type:"file",interface:"file-image"},standard:!0},{text:"Enabled",value:"enabled",field:{type:"boolean",interface:"boolean"},standard:!0},{text:"Product Type",value:"product_type",field:{type:"string"},standard:!0},{text:"Family",value:"family",field:{type:"integer"},standard:!0},{text:"Created",value:"date_created",field:{type:"timestamp",interface:"datetime"},standard:!0},{text:"Updated",value:"date_updated",field:{type:"timestamp",interface:"datetime"},standard:!0},...l.attributes.map((e=>({text:e.label,value:`attr_${e.code}`,field:{type:"alias"},attribute:!0})))])),N=i((()=>{const e=x.value.toLowerCase();return U.value.filter((t=>t.standard&&t.text.toLowerCase().includes(e)))})),F=i((()=>{const e=x.value.toLowerCase();return U.value.filter((t=>t.attribute&&t.text.toLowerCase().includes(e)))})),E=i({get:()=>l.tableHeaders,set:e=>{r("update:tableHeaders",e)}});g((()=>l.tableHeaders),(e=>{A.value||(j.value=e.map((e=>e.value)))}),{immediate:!0}),h((()=>{var e,t;(null==(t=null==(e=l.layoutOptions)?void 0:e.savedColumns)?void 0:t.length)>0&&(A.value=!0,j.value=l.layoutOptions.savedColumns,z(),setTimeout((()=>{A.value=!1}),500))}));const $=e=>e.startsWith("attr_"),T=e=>{if(!$(e))return null;const t=e.replace("attr_","");return l.attributes.find((e=>e.code===t))},D=()=>{S.value=!0},R=()=>{j.value=["primary_image","id","enabled","date_created"],r("update:layoutOptions",ae(le({},l.layoutOptions),{savedColumns:null,columnWidths:null})),W()},K=e=>{E.value=e,A.value||setTimeout((()=>{B()}),300)},W=()=>{const e=j.value.map((e=>{var t,a,i;const o=U.value.find((t=>t.value===e));if(!o)return null;const n=(null==(a=null==(t=l.layoutOptions)?void 0:t.columnWidths)?void 0:a[e])||150;return{text:o.text,value:o.value,width:n,align:"left",sortable:!["json","alias"].includes((null==(i=o.field)?void 0:i.type)||""),field:o.field}})).filter((e=>null!==e));E.value=e,S.value=!1,B()},z=()=>{var e;if(!(null==(e=l.layoutOptions)?void 0:e.savedColumns))return;const t=l.layoutOptions.savedColumns.map((e=>{var t,a,i;const o=U.value.find((t=>t.value===e));if(!o)return null;const n=(null==(a=null==(t=l.layoutOptions)?void 0:t.columnWidths)?void 0:a[e])||150;return{text:o.text,value:o.value,width:n,align:"left",sortable:!["json","alias"].includes((null==(i=o.field)?void 0:i.type)||""),field:o.field}})).filter((e=>null!==e));t.length>0&&(A.value=!0,E.value=t,setTimeout((()=>{A.value=!1}),100))},B=()=>{var e,t;if(A.value)return;const a=E.value.map((e=>e.value)),i={};E.value.forEach((e=>{e.width&&(i[e.value]=e.width)}));const o=(null==(e=l.layoutOptions)?void 0:e.savedColumns)||[],n=(null==(t=l.layoutOptions)?void 0:t.columnWidths)||{},u=JSON.stringify(a)!==JSON.stringify(o),s=JSON.stringify(i)!==JSON.stringify(n);(u||s)&&r("update:layoutOptions",ae(le({},l.layoutOptions),{savedColumns:a,columnWidths:i}))},J=e=>{l.onRowClick(e)};return(e,t)=>{var l,a;const i=o("v-icon"),r=o("v-button"),g=o("v-input"),h=o("v-checkbox"),w=o("v-menu"),O=o("v-list-item-icon"),P=o("v-list-item-content"),A=o("v-list-item"),U=o("v-divider"),z=o("v-list"),G=o("render-display"),q=o("v-pagination"),Q=o("v-select"),Y=o("v-table");return n(),u("div",ie,[s(" Column selector "),v(w,{modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=e=>S.value=e),"close-on-content-click":!1},{activator:m((({toggle:e})=>[v(r,{class:"add-columns-button",icon:"",small:"",onClick:e},{default:m((()=>[v(i,{name:"view_column"})])),_:2},1032,["onClick"])])),default:m((()=>[c("div",oe,[c("div",ne,[c("h3",null,p(k("select_columns")),1),v(g,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),type:"search",placeholder:k("search_columns"),"prepend-icon":"search"},null,8,["modelValue","placeholder"])]),c("div",ue,[s(" Standard fields "),c("div",re,[c("div",se,p(k("standard_fields")),1),(n(!0),u(d,null,y(N.value,(e=>(n(),b(h,{key:e.value,modelValue:j.value,"onUpdate:modelValue":t[1]||(t[1]=e=>j.value=e),value:e.value,label:e.text},null,8,["modelValue","value","label"])))),128))]),s(" Attribute fields "),F.value.length>0?(n(),u("div",de,[c("div",ce,p(k("attributes")),1),(n(!0),u(d,null,y(F.value,(e=>(n(),b(h,{key:e.value,modelValue:j.value,"onUpdate:modelValue":t[2]||(t[2]=e=>j.value=e),value:e.value,label:e.text},null,8,["modelValue","value","label"])))),128))])):s("v-if",!0)]),c("div",ve,[v(r,{secondary:"",onClick:R},{default:m((()=>[f(p(k("reset_to_default")),1)])),_:1}),v(r,{onClick:W},{default:m((()=>[f(p(k("apply")),1)])),_:1})])])])),_:1},8,["modelValue"]),s(" Table "),v(Y,{ref_key:"tableRef",ref:C,modelValue:H.value,"onUpdate:modelValue":t[5]||(t[5]=e=>H.value=e),headers:E.value,"onUpdate:headers":[t[6]||(t[6]=e=>E.value=e),K],class:"product-table","fixed-header":"","show-select":e.showSelect,"show-resize":"","allow-header-reorder":"","must-sort":null!==e.tableSort,sort:e.tableSort||{by:"date_created",desc:!0},items:e.items,loading:e.loading,"item-key":null!=(a=null==(l=e.primaryKeyField)?void 0:l.field)?a:"id",clickable:!e.readonly,"selection-use-keys":"","row-height":e.tableRowHeight,"onClick:row":J,"onUpdate:sort":e.onSortChange},_({"header-context-menu":m((({header:e})=>[v(z,null,{default:m((()=>[v(A,{disabled:e.required||E.value.length<=1,clickable:"",onClick:t=>(e=>{const t=E.value.filter((t=>t.value!==e.value));E.value=t,j.value=t.map((e=>e.value)),B()})(e)},{default:m((()=>[v(O,null,{default:m((()=>[v(i,{name:"visibility_off"})])),_:1}),v(P,null,{default:m((()=>[f(p(k("hide_field")),1)])),_:1})])),_:2},1032,["disabled","onClick"]),v(U),v(A,{clickable:"",onClick:D},{default:m((()=>[v(O,null,{default:m((()=>[v(i,{name:"view_column"})])),_:1}),v(P,null,{default:m((()=>[f(p(k("manage_columns")),1)])),_:1})])),_:1})])),_:2},1024)])),footer:m((()=>[c("div",pe,[c("div",me,[e.totalPages>1?(n(),b(q,{key:0,length:e.totalPages,"total-visible":7,"show-first-last":"","model-value":e.page,"onUpdate:modelValue":e.toPage},null,8,["length","model-value","onUpdate:modelValue"])):s("v-if",!0)]),!e.loading&&(e.items.length>=25||e.limit<25)?(n(),u("div",fe,[c("span",null,p(k("per_page")),1),v(Q,{"model-value":`${V.value}`,items:I,inline:"","onUpdate:modelValue":t[4]||(t[4]=e=>V.value=+e)},null,8,["model-value"])])):s("v-if",!0)])])),_:2},[y(E.value,(t=>({name:`item.${t.value}`,fn:m((({item:l})=>{var a,i,o,u,r,s,d,c;return["primary_image"===t.value?(n(),b(L,{key:0,"image-id":(null==(o=null==(i=null==(a=l.product_assets)?void 0:a[0])?void 0:i.assets_id)?void 0:o.media_file)||l[t.value],alt:`Product ${l.id}`},null,8,["image-id","alt"])):$(t.value)?(n(),b(M,{key:2,value:l[t.value],attribute:T(t.value)},null,8,["value","attribute"])):(n(),b(G,{key:1,value:l[t.value],display:(null==(u=t.field)?void 0:u.display)||null,options:(null==(r=t.field)?void 0:r.displayOptions)||null,interface:(null==(s=t.field)?void 0:s.interface)||null,"interface-options":(null==(d=t.field)?void 0:d.interfaceOptions)||null,type:(null==(c=t.field)?void 0:c.type)||"string",collection:e.collection,field:t.value},null,8,["value","display","options","interface","interface-options","type","collection","field"]))]}))})))]),1032,["modelValue","headers","show-select","must-sort","sort","items","loading","item-key","clickable","row-height","onUpdate:sort"])])}}});G("\n.v-table[data-v-05b8907c] table {\n\tmin-width: calc(100% - var(--content-padding)) !important;\n\tmargin-left: var(--content-padding);\n}\n",{});var be=K(ye,[["__scopeId","data-v-05b8907c"],["__file","ProductTable.vue"]]),ge=Object.defineProperty,he=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable,Oe=(e,t,l)=>t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;const ke={class:"layout-tabular-enhanced"};var Ce=l({__name:"tabular-enhanced-v2",props:{collection:{},selection:{default:()=>[]},readonly:{type:Boolean,default:!1},tableHeaders:{default:()=>[]},showSelect:{default:"none"},items:{default:()=>[]},loading:{type:Boolean,default:!1},error:{default:null},totalPages:{default:1},tableSort:{default:null},tableRowHeight:{default:48},page:{default:1},toPage:{},itemCount:{default:0},fields:{},limit:{default:25},primaryKeyField:{},info:{},sortField:{},search:{default:""},filter:{},onSortChange:{},onRowClick:{},useCustomApi:{type:Boolean},layoutOptions:{}},emits:["update:selection","update:tableHeaders","update:limit","update:fields","update:layoutOptions"],setup(e,{emit:t}){var l;const i=e,o=t,r=a([]),s=a([]);i.tableHeaders&&0!==i.tableHeaders.length||(null==(l=i.layoutOptions)?void 0:l.savedColumns)||o("update:tableHeaders",[{text:"Image",value:"primary_image",width:100,align:"left",sortable:!1,field:{type:"file",interface:"file-image"}},{text:"ID",value:"id",width:200,align:"left",sortable:!0,field:{type:"string"}},{text:"Enabled",value:"enabled",width:100,align:"left",sortable:!0,field:{type:"boolean",interface:"boolean"}},{text:"Created",value:"date_created",width:200,align:"left",sortable:!0,field:{type:"timestamp",interface:"datetime"}}]),h((()=>{i.useCustomApi?d():(c(),p())}));const d=()=>{if(!i.items||0===i.items.length)return;const e=i.items[0],t=Object.keys(e).filter((e=>e.startsWith("attr_"))).map((e=>{const t=e.replace("attr_",""),l=t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ");return{id:e,code:t,label:l,is_searchable:!0}}));if(r.value=t,r.value.length>0){const e=[...i.tableHeaders],t=new Set(e.map((e=>e.value))),l=r.value.filter((e=>!t.has(`attr_${e.code}`))).map((e=>({text:e.label,value:`attr_${e.code}`,width:150,align:"left",sortable:!0,field:{type:"alias"}})));l.length>0&&o("update:tableHeaders",[...e,...l])}},c=()=>{if(!i.items||0===i.items.length)return;const e=new Map;i.items.forEach((t=>{Array.isArray(t.attributes)&&t.attributes.forEach(((t,l)=>{if(t.attribute_id&&"object"==typeof t.attribute_id){const l=t.attribute_id;e.has(l.id)||e.set(l.id,{id:l.id,code:l.code,label:l.label,is_searchable:l.is_searchable||!1})}}))})),r.value=Array.from(e.values())},p=()=>{if(i.items&&0!==i.items.length)if(i.items[0]&&i.items[0].attributes){const e=i.items.map((e=>{const t=((e,t)=>{for(var l in t||(t={}))_e.call(t,l)&&Oe(e,l,t[l]);if(he)for(var l of he(t))we.call(t,l)&&Oe(e,l,t[l]);return e})({},e);return Array.isArray(e.attributes)&&e.attributes.forEach((e=>{let l=null,a=null;if("object"==typeof e.attribute_id&&e.attribute_id?(l=e.attribute_id,a=l.id):"number"!=typeof e.attribute_id&&"string"!=typeof e.attribute_id||(a=e.attribute_id,l=r.value.find((e=>e.id===a))),l&&l.code){let a=e.value;if(a&&"object"==typeof a&&"value"in a)a=a.value;else if("string"==typeof a)try{const e=JSON.parse(a);a=e&&"object"==typeof e&&"value"in e?e.value:e}catch(e){}t[`attr_${l.code}`]=a}})),t}));s.value=e}else s.value=i.items;else s.value=[]};return g((()=>i.items),(e=>{e&&e.length>0&&(i.useCustomApi?d():p())}),{immediate:!0}),g((()=>{var e;return null==(e=i.items)?void 0:e.length}),((e,t)=>{e&&e!==t&&(i.useCustomApi?d():c())})),(e,t)=>(n(),u("div",ke,[v(be,{items:i.useCustomApi?i.items:s.value,loading:e.loading,collection:e.collection,selection:e.selection,"show-select":e.showSelect,readonly:e.readonly,"table-headers":e.tableHeaders,"table-sort":e.tableSort,"table-row-height":e.tableRowHeight,"on-row-click":e.onRowClick,"on-sort-change":e.onSortChange,page:e.page,"to-page":e.toPage,"total-pages":e.totalPages,"item-count":e.itemCount,limit:e.limit,"primary-key-field":e.primaryKeyField,attributes:r.value,"layout-options":e.layoutOptions,"onUpdate:selection":t[0]||(t[0]=e=>o("update:selection",e)),"onUpdate:tableHeaders":t[1]||(t[1]=e=>o("update:tableHeaders",e)),"onUpdate:limit":t[2]||(t[2]=e=>o("update:limit",e)),"onUpdate:layoutOptions":t[3]||(t[3]=e=>o("update:layoutOptions",e))},null,8,["items","loading","collection","selection","show-select","readonly","table-headers","table-sort","table-row-height","on-row-click","on-sort-change","page","to-page","total-pages","item-count","limit","primary-key-field","attributes","layout-options"])]))}});G("\n.layout-tabular-enhanced[data-v-41a9bea5] {\n  display: contents;\n}\n",{});var Pe=K(Ce,[["__scopeId","data-v-41a9bea5"],["__file","tabular-enhanced-v2.vue"]]);var Se=Object.defineProperty,xe=Object.defineProperties,je=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,Ve=(e,t,l)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;const Ue={class:"field"},Ne={class:"type-label"};var Fe,Ee,$e=l((Fe=((e,t)=>{for(var l in t||(t={}))Ie.call(t,l)&&Ve(e,l,t[l]);if(Ae)for(var l of Ae(t))He.call(t,l)&&Ve(e,l,t[l]);return e})({},{inheritAttrs:!1}),Ee={__name:"options",props:{spacing:{}},emits:["update:spacing"],setup(e,{emit:t}){const l=e,a=t,{t:r}=P(),s=function(e,t,l){return i({get:()=>e[t],set(e){l(`update:${t}`,e)}})}(l,"spacing",a);return(e,t)=>{const l=o("v-select");return n(),u("div",Ue,[c("div",Ne,p(w(r)("layouts.tabular.spacing")),1),v(l,{modelValue:w(s),"onUpdate:modelValue":t[0]||(t[0]=e=>O(s)?s.value=e:null),items:[{text:w(r)("layouts.tabular.compact"),value:"compact"},{text:w(r)("layouts.tabular.cozy"),value:"cozy"},{text:w(r)("layouts.tabular.comfortable"),value:"comfortable"}]},null,8,["modelValue","items"])])}}},xe(Fe,je(Ee))));G(".field[data-v-f037e2a8] {\n  margin-bottom: var(--theme--form--row-gap);\n}\n\n.type-label[data-v-f037e2a8] {\n  margin-bottom: 8px;\n  color: var(--theme--foreground-subdued);\n  font-weight: 600;\n  font-size: var(--theme--fonts--monospace--font-size);\n  font-family: var(--theme--fonts--monospace--font-family);\n}",{});var Te=K($e,[["__scopeId","data-v-f037e2a8"],["__file","options.vue"]]);var De=Object.defineProperty,Re=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,Be=(e,t,l)=>t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,Je=(e,t)=>{for(var l in t||(t={}))We.call(t,l)&&Be(e,l,t[l]);if(Me)for(var l of Me(t))ze.call(t,l)&&Be(e,l,t[l]);return e},Ge=(e,t)=>Re(e,Ke(t)),Le=e({id:"product-grid",name:"Product Grid",icon:"grid_view",component:Pe,slots:{options:Te,sidebar:()=>null,actions:()=>null},setup(e,{emit:l}){const{collection:o,filter:n,search:u}=k(e),r=C("api"),{primaryKeyField:s,fields:d,info:c,sortField:v}=t(o),p=a([]),m=a(!1),f=a(null),y=a(1),b=a(0),h=a(0),_=i({get:()=>e.selection||[],set:e=>l("update:selection",e)}),w=i({get:()=>e.layoutOptions||{},set:e=>l("update:layoutOptions",e)}),O=i({get:()=>e.layoutQuery||{},set:e=>l("update:layoutQuery",e)}),P=i({get:()=>O.value.page||1,set:e=>{O.value=Ge(Je({},O.value),{page:e})}}),x=i({get:()=>O.value.limit||25,set:e=>{O.value=Ge(Je({},O.value),{limit:e})}}),j=i({get:()=>O.value.sort||[],set:e=>{O.value=Ge(Je({},O.value),{sort:e})}});async function A(){var e,t;if("products"===o.value){m.value=!0,f.value=null;try{const l={page:P.value,limit:x.value,sort:(null==(e=j.value)?void 0:e[0])||"-date_created",search:u.value||"",filter:n.value?JSON.stringify(n.value):void 0},a=await r.get("/product-grid/products",{params:l});p.value=a.data.data||[],h.value=(null==(t=a.data.meta)?void 0:t.total_count)||0,b.value=h.value,y.value=Math.ceil(h.value/x.value)}catch(e){console.error("[Product Grid] Error loading items:",e),f.value=e,p.value=[]}finally{m.value=!1}}else console.warn("[Product Grid] This layout only works with products collection")}const I=a([]),H=i((()=>{var e;return(null==(e=j.value)?void 0:e[0])?j.value[0].startsWith("-")?{by:j.value[0].substring(1),desc:!0}:{by:j.value[0],desc:!1}:null})),V=i({get:()=>w.value.spacing||"cozy",set:e=>{w.value=Ge(Je({},w.value),{spacing:e})}}),U=i((()=>{switch(V.value){case"compact":return 32;case"cozy":default:return 48;case"comfortable":return 64}}));g([P,x,j,n,u],(()=>{A()})),A();const{onClick:N}=function(e,t,l,a,i){const o=S();return{onClick:function({item:n,event:u}){var r;if(console.log("[Product Click Handler] onClick called",{item:n,event:u,readonly:i,selectMode:a}),i)return;const s=n[(null==(r=t.value)?void 0:r.field)||"id"];if(a||l.value.length>0){console.log("[Product Click Handler] In selection mode, toggling selection");const e=l.value.indexOf(s);return void(l.value=-1===e?[...l.value,s]:l.value.filter((e=>e!==s)))}const d=`/content/${e.value}/${s}`;console.log("[Product Click Handler] Navigating to:",d),u.ctrlKey||u.metaKey?window.open(window.location.origin+d,"_blank"):o.push(d)}}}(o,s,_,e.selectMode||!1,e.readonly||!1);return{items:p,loading:m,error:f,totalPages:y,itemCount:b,totalCount:h,tableHeaders:I,tableSort:H,tableRowHeight:U,spacing:V,collection:o.value,primaryKeyField:s,info:c,fields:d,refresh:function(){A()},toPage:function(e){P.value=e},onSortChange:function(e){if(!(null==e?void 0:e.by))return void(j.value=[]);let t=e.by;!0===e.desc&&(t="-"+t),j.value=[t]},onRowClick:N,selectAll:function(){if(!s.value||!p.value)return;const e=s.value.field;_.value=p.value.map((t=>t[e]))},page:P,limit:x,selection:_,showSelect:e.selectMode?"multiple":"none",readonly:e.readonly||!1,search:u,filter:n,sortField:v,useCustomApi:!0,layoutOptions:w}}});export{Le as default};
